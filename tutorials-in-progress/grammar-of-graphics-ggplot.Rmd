---
title: "The grammar of ggplot graphics"
author: "Alison Link"
date: "July 20, 2016"
output: 
  html_document:
    css: styles.css
    fig_caption: false
---


***

**Related to:** _Data Computing_, "Frames, Glyphs, and other Components of Graphics", Ch. 6; "Graphics and Their Grammar", Ch. 8

***

## ggplot: R's graphical "sandwich artist"
Have you ever admired the "sandwich artists" who so skillfully put together your sandwich at Subway?  Have you ever wanted to learn how to create and serve up graphics that are a feast for the eyes and as tasty as your favorite sub sandwich?  Well, today's your lucky day!  Pull on your latex gloves and get ready to become a "sandwich"...erm... "graphics" artist!

At this point, you should know how to make a few different basic plots (ex: barplot, histogram, scatterplot).  And up until now, you've been making these basic plots using built-in "base R" functions and graphics settings.  This approach works just fine for exploratory analysis as you're first getting acquainted with your data.  But if you want to make more polished graphics to share as part of a report or publication, you're going to want up your graphics game a bit.  This is where the ggplot library comes in!

Putting together graphics using ggplot is a lot Like making a sub sandwich: you need to decide what kind of "bread" to have on the outside, what kinds of "toppings" you're going to have on the inside, and how you're going to "slice it up" before you serve it.  Do you need a graphic that's as simple and delicious as a single-serving ham and cheese sub?  Or do you need a graphic that's as loaded as a giant party sub, with lots of different topics and slices?  Either way, ggplot can help you out.  

To get started with ggplot, you'll need to make sure to install it the first time you use it:

```{r, eval=FALSE}
install.packages("ggplot2")
```

After ggplot is successfully installed, every time you want to use it, just make sure to load the library by running the following line of code at the beginning of your project.  Generally, you should only need to run this once at the beginning of each R project or session:

```{r, warning=FALSE, message=FALSE}
library(ggplot2)
```

And before we get started making some graphics, let's load up the data set on energy and water usage for Minneapolis public buildings.  Make sure the .CSV file containing the data is in your R working directory, then load the dataset into your R environment:
```{r}
library(dplyr)

data <- read.csv("mpls_benchmarking_2014.csv", header=TRUE, na.strings=c("N/A", "Not Available", "#REF!"))

private_buildings <- data %>% filter(public_private == "private")
public_buildings <- data %>% filter(public_private == "public")
```

#### Pro tip: Why "ggplot2"?
You may be wondering: _Why do I need to load "ggplot2" instead of just simply "ggplot"? What happened to ggplot number 1?_  ggplot is a relatively old library, so there _was_ an original version called [ggplot1](https://github.com/hadley/ggplot1).  Starting around 2008, however, the library was rewritten as "ggplot2".  The original ggplot is now out of date, and you will need to load ggplot2 to get the most current version.  To learn more about ggplot2, check out the [ggplot2.org](http://ggplot2.org/) website.


## The whole thing
Here's the general format for creating a ggplot graphic.  We'll go into each of these components separately, but for now, just get a quick sense of how an entire graphic can be assembled, sandwich-style:

[graphic showing format for ggplot(data, aes(x= , y= )) and equating it to bread]

Yellow = frame/bread
ggplot(data, aes(x = x_varible, y = y_variable, col/fill = color_variable)) +
xlab()
xlim()

Red = glyphs/toppings
geom_glyph_type() +

Blue = facet/slices
facet_wrap()


## The Frame: The "bread" for your graphics

The **frame** acts a lot like the bread that will hold your graphical "sandwich" together.  The frame is simply the grid upon which you'll build the rest of your graphics.  When you're setting up the frame for your graphics, you need to call the `ggplot()` function and pass it two arguments: 1) the dataset you want to plot, and 2) a set of parameters called "aesthetics", wrapped in `aes()`.  

The "aesthetics" in ggplot can be a little confusing until you get used to using them.  In general the aesthetics , so for now, just know that 



Some graphics only need a single "x" value in the aesthetic.  For example, here's the frame for a plot that looks at the the floor areas of the various buildings in our dataset:
```{r}
ggplot(data, aes(x=floor_area))
```

Some graphics need both an "x" and a "y" value in the aesthetic.  For example, here's the frame for a plot comparing the year a building was built (independent variable) to its Energy Star score (dependent variable):
```{r}
ggplot(data, aes(x=year_built, y=energy_star_score))
```

#### Pro tip: Adding axis labels and limits {.pro-tip}

```{r}
ggplot(data, aes(x=year_built, y=energy_star_score)) +
  xlab("Year built") + 
  ylab("Emergy Star score")
```



## Glyphs: Your graphical "toppings"

And any decent graphical sandwich wouldn't be complete without toppings!  "Glyphs" are the graphical equivalent of sandwich toppings: they're the shapes, points, lines, curves, and other visuals you put inside of the frame you've just created.  If you take a quick look at table of contents of the [ggplot documentation](https://cran.r-project.org/web/packages/ggplot2/ggplot2.pdf), you can see that ggplot2 offers you a total of 28 different glyphs to choose from!  But don't worry--there are only a few common glyphs that you'll need to know for now, and you can save the rest for later exploration on your own.

But first, there are two main questions you need to answer about your data before working with glyphs.  The answer to these questions will limit your choice of glyphs, since not all glyphs work with all data types.  So, think about the type of graphic you want to create, and then ask yourself:

* **Do I want to depict the shape/distribution of a _single_ variable only?  Or do I want to show the relationship between _two_ variables?**

* **Is my "x" variable _continuous_, or is my "x" variable _categorical_?**  "Continuous" variables are variables like numeric or integer variables that can take any possible value along a number line.  For example, in our buildings dataset, "Year\_Built" and "ENERGY\_STAR\_score" are both continuous variables. "Categorical" variables are usually character or factor variables, where the variable can only take a values within a specific set of categories.  For example, in our buildings dataset, "Prop\_Type" and "Organization" are categorical values because they can each only take values that fall within a specific set of categories: there are only 10 possible property type values, and 4 organizations present in the dataset.

Some glyphs work with a single, continuous "x" variable. For example, you can use the `geom_histogram()` glyph type to examine the floor area ("Prop\_Flr\_Area") of the buildings in our dataset, which is a continuous integer variable. Set up the frame using the "Prop\_Flr\_Area" as the x aesthetic, then use the `geom_histogram()` glyph to add a histogram to the graphic:

```{r}
ggplot(data, aes(x=floor_area)) +
  geom_histogram()
```


Some glyphs require both an "x" and "y" variable.  For example, you can use the `geom_point()` glyph to take the buildings' "Year\_Built" as an independent variable and compare it to the buildings' "ENERGY\_STAR\_score" values as a dependent variable. Set up the frame using the "Year\_Built" as the x aesthetic, and "ENERGY\_STAR\_score" as the y aesthetic.  Then, use the `geom_point()` glyph to add points to the graphic to create a scatterplot:

```{r}
ggplot(data, aes(x=year_built, y=energy_star_score)) +
  geom_point()
```


Some glyphs, such as `geom_boxplot()` require a categorical variable for the "x" aesthetic, and a continuous variable for the "y" aesthetic:

```{r}
ggplot(public_buildings, aes(x=org_name, y=site_EUI)) +
  geom_boxplot()

ggplot(public_buildings, aes(x=org_name, y=site_EUI)) +
  geom_violin()
```


Glyph            | Aesthetic                                 | Graphical result
---------------- | ----------------------------------------- | ---------------------------------
geom_histogram() | x (continuous)                            | histogram
geom_density     | x (continuous)                            | density plot (similar to a histogram, but with a curved line instead of a series of bars indicating where data is most densely distributed)
geom_point()     | x (continuous) & y (continuous)           | scatterplot
geom_boxplot()   | x (categorical) & y (continuous)          | grouped boxplot
geom_violin()    | x (categorical) & y (continuous)          | grouped violin plot (a comgination of a boxplot and a density plot)



#### Pro tip: Adding colors/fills {.pro-tip}

Sometimes you want to add a little splash of color to your graphic--kind of like adding a little bit of "special sauce" to a subway sandwich.  Colors are useful 

Generally, you can add color to your plot by simply adding a `col=variable_name` or `fill=variable_name` argument to your aesthetics when you're setting up the plot.  

Colors can be used to show categorical variables:
```{r}
ggplot(public_buildings, aes(x=year_built, y=energy_star_score, col=org_name)) +
  geom_point()
```

Colors can be used to show continuous variables:

```{r}
ggplot(data, aes(x=year_built, y=energy_star_score, col=total_GHG_emissions)) +
  geom_point()
```

If you're using colors on a boxplot, violin plot, or other plot that has shapes that need to be filled, use the `fill=` argument, rather than the `col=` argument.  (If you )

```{r}
library("RColorBrewer")
ggplot(data, aes(x=Prop_Type, y=ENERGY_STAR_score, fill=Prop_Type)) +
  geom_boxplot() +
  scale_fill_manual(values = c("darkred", "red", "orange", "yellow", "green", "seagreen", "blue", "violet", "purple", "purple4"))
```

If you don't like ggplot's default colors, you can also define your own custom colors to use in your graphic.  Simply add the `scale_colour_continuous(low = , high = )`, the `scale_colour_manual(values = c())` or `scale_fill_manual(values = c())` options to your graphic:





### Activity A: Practice your graphical art! {.activity}

Make at least three plots featuring your choice of variables from the Minneapolis public building energy usage dataset.  Make sure each of your plots uses a different glyph type.  Add color to at least one of your plots.

For each plot, write a 1-2 sentence description explaining what the plot is demonstrating about the variables you looked at.


## Facets: Slice up your graphics


```{r}
ggplot(data, aes(x=Total_GHG)) +
  geom_histogram() +
  facet_wrap( ~ Prop_Type)
```


### Activity B: {.activity}

Make a graphic with the aesthetic `x=Prop_Flr_Area, y=water_gallons`
as.numeric()
```{r}
ggplot(data, aes(x=Prop_Flr_Area, y=ENERGY_STAR_score)) +
  geom_point() +
  geom_smooth(method='lm')
```
